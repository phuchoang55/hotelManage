<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/admin-layout}">
<head>
    <title th:text="${restaurant.id} != null ? 'Sửa nhà hàng' : 'Thêm nhà hàng'"></title>
</head>
<body>
<div layout:fragment="content">
    <h1 th:text="${restaurant.id} != null ? 'Sửa nhà hàng' : 'Thêm nhà hàng'"></h1>
    <form th:action="${restaurant.id} != null ? @{'/admin/restaurants/' + ${restaurant.id}} : @{/admin/restaurants}"
          method="post"
          enctype="multipart/form-data"
          class="form">
        <label>Tên
            <input type="text" name="name" th:value="${restaurant.name}" required />
        </label>
        <label>Ẩm thực
            <input type="text" name="cuisineType" th:value="${restaurant.cuisineType}" />
        </label>
        <label>Mô tả
            <input type="text" name="description" th:value="${restaurant.description}" />
        </label>
        <label>Giờ mở cửa
            <input type="text" name="openingHours" th:value="${restaurant.openingHours}" />
        </label>
        <label>Liên hệ
            <input type="text" name="contactInfo" th:value="${restaurant.contactInfo}" />
        </label>
        <label>Giá tham khảo
            <input type="text" name="priceRange" th:value="${restaurant.priceRange}" />
        </label>
        <label>Khuyến mãi
            <input type="text" name="promotionText" th:value="${restaurant.promotionText}" />
        </label>
        <div class="dropzone" id="dz" onclick="dzFile.click()" ondragover="dzDrag(event)" ondragleave="dzLeave(event)" ondrop="dzDrop(event)">
            <input type="file" id="dzFile" name="image" accept="image/*" hidden onchange="dzPreview(this.files)" />
            <div>Thả ảnh vào đây hoặc bấm để chọn</div>
            <div class="hint">Hỗ trợ: JPG, PNG, WEBP. Tối đa ~5MB</div>
            <div class="preview" id="dzPreview">
                <img th:src="${restaurant.imageUrl} ?: @{/images/placeholder-restaurant.svg}" alt="preview"/>
            </div>
        </div>
        <div class="modal-actions">
            <a class="btn" th:href="@{/admin/restaurants}">Hủy</a>
            <button class="btn primary" type="submit">Lưu</button>
        </div>
    </form>
</div>

<th:block layout:fragment="extra-js">
    <script>
        const dz = document.getElementById('dz');
        const dzFile = document.getElementById('dzFile');
        const dzPreviewEl = document.getElementById('dzPreview');
        function dzDrag(e){ e.preventDefault(); dz.classList.add('dragover'); }
        function dzLeave(e){ e.preventDefault(); dz.classList.remove('dragover'); }
        function dzDrop(e){ e.preventDefault(); dz.classList.remove('dragover'); if(e.dataTransfer&&e.dataTransfer.files&&e.dataTransfer.files[0]){ dzFile.files=e.dataTransfer.files; dzPreviewFiles(e.dataTransfer.files); } }
        function dzPreview(files){ dzPreviewFiles(files); }
        function dzPreviewFiles(files){ dzPreviewEl.innerHTML=''; if(!files||!files[0]) return; const file=files[0]; const reader=new FileReader(); reader.onload=function(e){ const img=document.createElement('img'); img.src=e.target.result; dzPreviewEl.appendChild(img); }; reader.readAsDataURL(file); }
    </script>
</th:block>
</body>
</html>
